@startuml
'https://plantuml.com/sequence-diagram
autonumber

actor User
participant TraceX
participant "Digital Twin Registry" as DTR
participant IRS

User -> TraceX: Open asset list
TraceX -> DTR: lookup assets by BPN configured
rnote right TraceX
Once per day, schedule based
end rnote
TraceX <-- DTR: List<aasID>

TraceX -> DTR: Get shell by AAS identifier: ""/registry/shell-descriptors/{aasIdentifier}""
TraceX <-- DTR: Shell Descriptor
TraceX -> TraceX: Merge Data to Backend
rnote right TraceX
manufacturerId, manufacturerPartId, partInstanceId, idShort, batchId, globalAssetId, customerPartId, van
end rnote
TraceX -> TraceX: extract globalAssetId as CatenaX UUID
TraceX -> TraceX: Calculate delta CX UUIDs for only new ones

	loop for each new CX_UUID
        TraceX -> IRS: register job to get submodel data
            rnote right TraceX
                aspects, globalAssetId, bomLifecycle, collectAspects, direction, depth
            end rnote
        TraceX <-- IRS: Submodel Data
        TraceX -> TraceX: extract objects
            rnote right TraceX
                relationships, shells, tombstones, submodels, bpns
            end rnote
		TraceX -> TraceX: Merge Data to Backend

	end
User <-- TraceX: List<Assets>

@enduml
